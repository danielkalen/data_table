(function(f){var e,m;m={checkbox:!0,perPage:20,actions:!1,ipDataFetcher:function(a){return new Promise(function(b){return f.get("http://ipinfo.io/"+a,b,"JSON")})}};e=function(a,b){this.container=a;this.options=b;this.tableOptions=f.extend({},m,this.options.table||{});this.data=[];this.els={};this.els.tableOuterwrap=f("<div class='data_table-outerwrap'> <table class='data_table chart horizontal {{hasCheckbox}}'> <thead class='data_table-head'> <tr class='data_table-head-row'> <th class='data_table-head-row-cell checkbox'> <div class='data_table-head-row-cell-text'><input class='data_table-checkbox' type='checkbox'></div> </th> <th class='data_table-head-row-cell is_expand_button'></th> {{columns}} </tr> </thead> <tbody class='data_table-body'></tbody> </table> {{pagination}} </div>".replace("{{hasCheckbox}}",
this.tableOptions.checkbox?"has_checkbox":"").replace("{{columns}}",this.generateColumns()).replace("{{pagination}}","<div class='data_table-pagination block-pagination'> <div class='data_table-pagination-item back'> <div class='data_table-pagination-item-text'></div> </div> {{pages}} <div class='data_table-pagination-item next'> <div class='data_table-pagination-item-text'></div> </div> </div>"));this.els.table=this.els.tableOuterwrap.children().first();this.els.tableHead=this.els.table.children().first().children();
this.els.tableBody=this.els.table.children().last();this.els.pagination=this.els.tableOuterwrap.children().last();this.els.tableOuterwrap.appendTo(this.container);this.els.table.data("DataTable",this);this.attachEvents().then(function(b){return function(){return b.attachBindings().then(function(){return b.fetchData()})}}(this));return this};e.prototype.fetchData=function(){return this.options.data().then(function(a){return function(b){return a.data=b}}(this))};e.prototype.generateColumns=function(){return this.options.columns.map(function(a){return"<th class='data_table-head-row-cell {{isSortable}} {{slug}}' data-slug='{{slug}}' data-icon='{{icon}}'> <div class='data_table-head-row-cell-text'>{{label}}</div> </th>".replace("{{isSortable}}",
a.sorting?"is_sortable":"").replace(/\{\{slug\}\}/g,a.label.toLowerCase().replace(/\W/g,"_")).replace("{{icon}}",a.icon||"").replace("{{label}}",a.label)}).join("")};e.prototype.generateBodyRows=function(a){var b,d,c,e,h,g,f,n,l;f="";b=function(b){return function(a,d,c){return f+="<tr class='data_table-body-row {{isSub}}' data-id='{{itemID}}'> <td class='data_table-body-row-cell checkbox'> <input class='data_table-checkbox' type='checkbox' data-id='{{itemID}}'> </td> <td class='data_table-body-row-cell is_expand_button'> <div class='data_table-body-row-cell-expand'></div> </td> {{cells}} </tr>".replace("{{isSub}}",
c?"is_sub is_hidden":"").replace(/\{\{itemID\}\}/g,c?d.ID:a.ID).replace("{{cells}}",function(){var d,c,e,f,h,g,k;k="";g=b.options.columns;f=e=0;for(h=g.length;e<h;f=++e)c=g[f],d=a[c.label]||"",k+="<td class='data_table-body-row-cell cell_{{slug}}' data-slug='{{slug}}'> <div class='data_table-body-row-cell-innerwrap'>{{value}}</div> </td>".replace(/\{\{slug\}\}/g,c.label.toLowerCase().replace(/\W/g,"_")).replace("{{value}}",function(){var a,e;switch(c.type){case "fields":return b.generateInlineFields(d);
case "actions":return b.generateActions();case "ip-details":return b.generateIpDetails(d);default:return(null!=(e=b.options.formatters)?"function"===typeof e[a=c.label]?e[a](d):void 0:void 0)||d}});return k})}}(this);d=0;for(e=a.length;d<e;d++)if(c=a[d],g=c.main||c,l=c.sub){b(g);c=0;for(h=l.length;c<h;c++)n=l[c],b(n,g,!0);this.els.table.addClass("is_expanding_table")}else b(g);return f};e.prototype.generateInlineFields=function(a){return"<div class='data_table-fields'>{{fields}}</div>".replace("{{fields}}",
function(){var b,d;if("object"!==typeof a)return"";var c;c=[];for(b in a)d=a[b],c.push("<div class='data_table-fields-item'> <div class='data_table-fields-item-label'>{{label}}: </div> <div class='data_table-fields-item-value'>{{value}}</div> </div>".replace("{{label}}",b).replace("{{value}}",d));return c.join("")})};e.prototype.generateActions=function(){return"<div class='data_table-actions'>{{actions}}</div>".replace("{{actions}}",function(a){return function(){var b;return a.tableOptions.actions?
function(){var a,c,e,f;e=this.tableOptions.actions;f=[];a=0;for(c=e.length;a<c;a++)b=e[a],f.push("<div class='data_table-actions-button color_{{color}}' data-action='{{action}}' data-icon='{{icon}}'> <div class='data_table-actions-button-text'>{{label}}</div> </div>".replace("{{action}}",b.action).replace("{{label}}",b.label).replace("{{icon}}",b.icon).replace("{{color}}",b.color||"grey"));return f}.call(a).join(""):""}}(this))};e.prototype.generateIpDetails=function(a){return"<div class='data_table-ip_details' data-ip={{ipAddress}}> <div class='data_table-ip_details-trigger'> <div class='data_table-ip_details-content'>Loading IP Details</div> </div> <div class='data_table-ip_details-country'></div> </div>".replace("{{ipAddress}}",
a)};e.prototype.attachEvents=function(){this.els.tableHead.on("click","th.is_sortable",function(a){return function(b){return a.sortBy(b.currentTarget.dataset.slug)}}(this));this.els.tableBody.on("click",".data_table-actions-button",function(a){return function(b){var d,c;d=f(b.currentTarget);b=d.closest("tr");d=d.data("action");c=b.data("id");b=b.index();return a.els.table.trigger("action."+d,{itemID:c,data:a.data[b]})}}(this));this.els.tableBody.on("click",".data_table-body-row-cell-expand",function(a){return function(a){var b;
a=f(a.currentTarget).closest("tr");b=a.data("row-id");a.siblings(".is_sub").filter(function(){return this.dataset.rowId===b}).toggleClass("is_hidden");return a.toggleClass("expanded")}}(this));SimplyBind("currentPage").of(this).to(function(a){return function(){return a.els.pagination.children().slice(1,-1).eq(a.currentPage-1).addClass("current").siblings().removeClass("current")}}(this));this.els.pagination.on("click",".data_table-pagination-item",function(a){return function(b){var d,c;b=f(b.currentTarget);
d=b.hasClass("back");c=b.hasClass("next");if(d){if(1!==a.currentPage)return a.currentPage--}else if(c){if(a.currentPage!==a.pageCount)return a.currentPage++}else return b=parseFloat(b.children().html()),a.currentPage=b}}(this));this.els.tableBody.on("mouseover",".data_table-ip_details-trigger",function(a){return function(b){var d,c,e;c=f(b.currentTarget);d=c.children();c.next();b=c.parent().data("ip");e=c.data("isLoaded");if(!e)return c.data("isLoaded",!e),a.tableOptions.ipDataFetcher(b).then(function(a){var b,
e;if(a){var f;f=[];for(b in a)e=a[b],f.push("<div class='data_table-ip_details-content-item'> <div class='data_table-ip_details-content-item-label'>{{label}}: </div> <div class='data_table-ip_details-content-item-value'>{{value}}</div> </div>".replace("{{label}}",b).replace("{{value}}",e));d.html(f.join(""));return c.parent().addClass("ready")}})}}(this));return Promise.resolve()};e.prototype.attachBindings=function(){SimplyBind.setOption("updateOnBind",!0);SimplyBind("data").of(this).to(function(a){return function(b){a.pageCount=
Math.ceil(b.length/a.tableOptions.perPage);15<a.pageCount&&(a.pageCount=15);return a.currentPage=1}}(this)).and.to("prop:innerHTML").of(this.els.tableBody).transform(function(a){return function(b){return a.generateBodyRows(b)}}(this)).and.to(function(a){return function(){SimplyBind.setOption("updateEvenIfSame",!0);a.currentPage=1;return SimplyBind.setOption("updateEvenIfSame",!1)}}(this));SimplyBind("pageCount").of(this).to("prop:innerHTML.pages").of(this.els.pagination).transform(function(a){var b,
d,c;c="";for(d=b=1;1<=a?b<=a:b>=a;d=1<=a?++b:--b)0!==d&&(c+="<div class='data_table-pagination-item'> <div class='data_table-pagination-item-text'>{{value}}</div> </div>".replace("{{value}}",d));return c});SimplyBind("currentPage").of(this).to(function(a){return function(b){var d,c;d=a.els.tableBody.children();c=d.slice((b-1)*a.tableOptions.perPage).slice(0,a.tableOptions.perPage);b=d.not(".hidden");b.length===d.length&&(b=d.slice(a.tableOptions.perPage));b.addClass("hidden");return c.removeClass("hidden")}}(this));
SimplyBind.setOption("updateOnBind",!1);return Promise.resolve()};e.prototype.sortBy=function(a){};e.version="1.0.2";return window.DataTable=e})(jQuery);
