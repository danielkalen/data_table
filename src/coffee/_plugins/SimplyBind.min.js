(function(){var x,k,p,y,h,q,z,H,A,I,B,J,C,K,D,L,M,E,N,t,g,l,u,m,F,G,v,w,f,r;C=function(a){var b;1<a.length?"radio"===a[0].type||"checkbox"===a[0].type?(b=a,a=[],Object.keys(b).forEach(function(c){if(!isNaN(parseFloat(c)))return a.push(b[c])})):(r("onlyOneDOMElement"),a=a[0]):a=a[0];return a};J=function(a){v.jQuery&&a instanceof jQuery&&(a=C(a),a.length&&(a=a[0]));return a};H=function(){var a;a=document.createEvent("Event");a.initEvent("change",!0,!1);a.fromSimplyBind=!0;return a};K=function(){return"sb_"+
Math.floor(1E12*(1+Math.random())).toString(16)};N=function(a){a=typeof a;return"string"===a||"number"===a};E=function(a){return a instanceof k};z={object:{set:function(a){var b,c;c="Event"===a.type?a.selector+"#"+a.eventName:a.selector;b=h.objects.indexOf(a.object);return-1===b?(b={},b[c]=a.ID,h.objects.push(a.object),h.props.push(b)):h.props[b][c]=a.ID},get:function(a){var b;b="Event"===a.type?a.selector+"#"+a.eventName:a.selector;a=h.objects.indexOf(a.object);if(-1!==a&&(a=h.props[a],null!=a[b]))return q[a[b]]}},
"function":{set:function(a){h.fns.push(a.object);return h.fnIDs.push(a.ID)},get:function(a){a=h.fns.indexOf(a.object);if(-1!==a)return q[h.fnIDs[a]]}},external:{set:function(a){h.external.push(a.object+":"+a.selector+"#"+JSON.stringify(a.reqOptions));return h.externalOpts.push(a.ID)},get:function(a){a=h.external.indexOf(a.object+":"+a.selector+"#"+JSON.stringify(a.reqOptions));if(-1!==a)return q[h.externalOpts[a]]}}};F=function(a,b){return{regEx:new RegExp(u.start+a+u.end,"g"),lastValue:b||""}};y=
function(a,b,c,d){var e;e=m.objects.indexOf(a);if(-1===e)return e={},e[b]=F(b,c),m.objects.push(a),m.placeholders.push(e),m.valueOriginals.push(d);a=m.placeholders[e];return null!=a[b]?a[b].lastValue=c:a[b]=F(b,c)};M=function(a){a=m.objects.indexOf(a);return m.placeholders[a]};L=function(a){a=m.objects.indexOf(a);return m.valueOriginals[a]};w=function(a,b){var c,d;d=D();c=b?a:B[a];throw Error("SimplyBind: "+(c+("\n\nCall Source:\n"+d)));};r=function(a){var b;if(!l.silent)return b=D(),a=B[a],console.log("SimplyBind: "+
(a+("\n\nCall Source:\n"+b)))};f=function(a){return w("You can't use/invoke ."+a+"() at this stage",!0)};D=function(){return Error().stack.split("\n").slice(3,10).map(function(a){return a.replace(I,function(a,c,d){return"@ "+d})}).join("\n")};I=/[@(?:\wat\s)](.*)\/(.+)$/;B={invalidParamName:"SimplyBind() and .to() only accept a function, a bound object, a string, or a number.",transformFn:"You can only pass a function to the .tranform/All() method",badObject:"You can only pass a non-primitive object to .of()",
badEventArg:"Invalid argument number in .ofEvent()",onlyOneDOMElement:"You can only pass 1 DOM element to SimplyBind unless it's a collection of radio/checkbox inputs",emptyElList:"You can't bind an empty element list to anything..."};v={jQuery:"undefined"!==typeof jQuery&&null!==jQuery};l={silent:!1,liveProps:!0,dispatchEvents:!1,updateEvenIfSame:!1,invokeOnBind:!0,mutateInherited:!1,mutateArrayMethods:!0,cacheRequests:!0,ignoreCase:!1,placeholderStart:"{{",placeholderEnd:"}}"};u={start:"\\{\\{",
end:"\\}\\}"};h={objects:[],props:[],fns:[],fnIDs:[],external:[],externalOpts:[]};q={};G={};m={objects:[],placeholders:[],valueOriginals:[]};p=function(a,b){if(!a&&0!==a||!N(a)&&"function"!==typeof a)E(a)||w("invalidParamName");return"object"===typeof a?new k(a._,1):new x(a,b)};x=function(a,b){var c,d;this.ID=this.type=null;this.selector=this.property=a;this.value=this.valueFull=this.valueOriginal=null;this.deps=[];this.depsBothWays=[];this.transforms={};this.attachedEvents=[];if("function"===typeof a){this.setType("Func");
c=this.setObject("function",a,b);if(c instanceof k)return c;d=1}else"number"===typeof this.selector&&(this.selector=this.selector.toString()),l.ignoreCase&&(this.selector=this.property=this.selector.toLowerCase(),"textcontent"===this.selector&&(this.selector=this.property="textContent")),-1!==this.selector.indexOf(":")&&(c=this.property.split(":"),this.descriptor=c[0],this.property=c[1]),-1!==this.selector.indexOf(".")&&(c=this.property.split("."),this.property=c[0],this.placeholder=c[1],2<c.length&&
c.slice(2).forEach(function(a){return function(b){return a.placeholder+="."+b}}(this)));return new k(this,d)};k=function(a,b,c,d,e){var n;this.stage=b||0;this.proxied=c;this.proxies=d&&d.length?d:c?[c]:[];this.has=e?e:{tf:!1,massTf:!1,initBind:!1,interval:!1,event:!1};n=this;return Object.defineProperties(this,{ID:{get:function(){return a.ID}},value:{get:function(){return a.valueFull}},original:{get:function(){return a.objects||a.object}},dependents:{get:function(){return a.deps.slice().map(function(a){return a.original})}},
"new":{value:function(b,c,d){return new k(a,b,c||n.proxied,d||n.proxies,n.has)}},_:{value:a}})};x.prototype={setObject:function(a,b,c,d,e){var n,g,f,h,m;h=1;E(b)&&(b=b.original);if(v.jQuery&&b instanceof jQuery&&(f=!0,this.object=b=C(b),!b))return this.stage=0,r("emptyElList");this.object=b;if("external"===a){this.type="Ajax";n={method:d};if(e)for(g in e)m=e[g],n[g]=m;this.reqOptions=n;"POST"===d&&(h=3)}c=this.fetchDirectValue(null,c);if(b instanceof NodeList||b instanceof HTMLCollection||f&&Array.isArray(b)){if(0===
b.length)return this.stage=0,r("emptyElList");this.object=null;d=this.objects=[].slice.call(b);b=0;for(f=d.length;b<f;b++)c=d[b],c.checked&&(this.object=c);this.object||(this.object=this.objects[0]);c=this.object.value}(this.isDOM=null!=this.object.nodeName&&this.object.nodeType)&&("textContent"===this.property?this.setTextNodesPlaceholders():"value"===this.property||this.descriptor||(c=this.fetchDirectValue("Attr")));if(b=z[a].get(this))return new k(b,h);"undefined"===typeof c&&"object"===a&&(this.object[this.property]=
c=null);this.value=this.valueFull=this.valueOriginal=c;this.placeholder&&"object"===a&&(this.value=l.placeholderStart+this.placeholder+l.placeholderEnd,-1===this.valueOriginal.indexOf(this.value)?(this.placeholder=null,this.value=this.valueOriginal):this.setPlaceholder());this.setID();this.setType();this.makePropertyLive();this.attachEvents();return z[a].set(this)},setEvent:function(a,b){isNaN(parseInt(this.property))&&r("badEventArg");this.type="Event";this.eventName=a;return this.customEventMethod=
b||null},processTransformCall:function(a,b){var c,d,e;if("function"!==typeof a)return r("transformFn");c=0;for(d=b.length;c<d;c++)e=b[c],e=e._,this.addTransform(e.ID,a),-1!==this.depsBothWays.indexOf(e)&&e.addTransform(this.ID,a);this.updateDeps(this.ID,!0,!0);return!0},destroy:function(){delete q[this.ID];if("Object"===this.type||"DomProp"===this.type||"Text"===this.type)return Object.defineProperty(this.object,this.property,{value:this.valueFull})},setID:function(){this.ID=K();return q[this.ID]=
this},setType:function(a){if(!this.type&&(this.type=a||"Object",this.isDOM))return"value"===this.property?this.type="Value":"textContent"===this.property?this.type="Text":"prop"===this.descriptor?this.type="DomProp":this.type="Attr"},setPlaceholder:function(a){null==a&&(a=this.object);return y(a,this.placeholder,this.value,this.valueOriginal)},attachEvents:function(){var a,b,c;if("Event"===this.type)return this.registerEvent(this.eventName,this.customEventMethod);if("Value"===this.type||"Text"===
this.type)if(a=this,b=function(b){if(!b.fromSimplyBind)return a.setValue(b.target.value)},c=this.objects?this.objects[0].nodeName.toUpperCase():this.object.nodeName.toUpperCase(),"INPUT"===c||"TEXTAREA"===c||"SELECT"===c){if("radio"===this.object.type||"checkbox"===this.object.type)return this.objects.forEach(function(a){return a.addEventListener("change",b,!1)});this.object.addEventListener("input",b,!1);return this.object.addEventListener("change",b,!1)}},setTextNodesPlaceholders:function(a){var b,
c,d,e;null==a&&(a=this.object);if(this.placeholder)for(e=a.childNodes,a=0,b=e.length;a<b;a++)c=e[a],3!==c.nodeType?this.setTextNodesPlaceholders(c):(d=l.placeholderStart+this.placeholder+l.placeholderEnd,-1!==c.textContent.indexOf(d)&&y(c,this.placeholder,this.value,c.textContent))},getNodeFullValue:function(a,b){return-1!==m.objects.indexOf(a)?this.applyPlaceholder(a):!1},fetchDirectValue:function(a,b){null==a&&(a=this.type);switch(a){case "Func":if(!b)return this.object();break;case "Ajax":if(!b)return this.networkReq();
break;case "Attr":return this.object.getAttribute(this.property);default:return this.object[this.property]}},applyTextContentReplace:function(a){var b,c,d,e,n;if(this.placeholder){e=a.childNodes;n=[];a=0;for(b=e.length;a<b;a++)d=e[a],3!==d.nodeType?n.push(this.applyTextContentReplace(d)):(c=this.getNodeFullValue(d),!1!==c?n.push(d.textContent=c):n.push(void 0));return n}return a.textContent=this.value},setValue:function(a,b,c){null==c&&(c=!1);if(b!==this.ID&&(a!==this.value||l.updateEvenIfSame)&&
(b||(b=this.ID),"undefined"!==typeof a&&(this.value=a,this.valueFull=this.placeholder?this.applyPlaceholder():a,this.arrayMethodsMutated?this.setArrayMethods():this.needsManualUpdate&&"Object"===this.type?this.object[this.property]=a:"Func"===this.type?this.value=this.valueFull=this.object(a):"Ajax"===this.type?(this.reqOptions.data=a,this.networkReq(b,c)):"Value"===this.type?this.objects?this.objects.forEach(function(b){return b.value===a?b.checked=!0:b.checked=!1}):(this.object.value=this.valueFull,
l.dispatchEvents&&this.object.dispatchEvent(H())):"DomProp"===this.type?this.inheritedOverriden||(this.object[this.property]=this.valueFull):"Attr"===this.type?this.object.setAttribute(this.property,this.valueFull):"Text"===this.type&&this.applyTextContentReplace(this.object,a)),"Ajax"!==this.type))return this.updateDeps(b,c)},updateDeps:function(a,b,c){var d,e,n,f,g;if(this.deps.length&&("Event"!==this.type||null!==this.value))for(g=this.deps,e=0,n=g.length;e<n;e++)d=g[e],b&&-1!==this.depsBothWays.indexOf(d)||
(f=this.applyTransform(d),c&&"Func"===d.type&&!l.invokeOnBind||d.setValue(f,a||this.ID,!0))},applyPlaceholder:function(a){var b,c,d;null==a&&(a=this.object);this.setPlaceholder(a);b=L(a);d=M(a);for(c in d)a=d[c],b=b.replace(a.regEx,a.lastValue);return b},applyTransform:function(a){return null!=this.transforms[a.ID]?this.transforms[a.ID](this.value,a.value):this.value},makePropertyLive:function(){var a,b,c,d,e,g,f;if(("Object"===this.type||"DomProp"===this.type)&&l.liveProps)return b=this.object.propertyIsEnumerable(this.property),
e=l.mutateInherited||b,a=this,e?(e=Object.getOwnPropertyDescriptor(this.object,this.property),c=(null!=e?null!=(g=e.get)?g.bind(this.object):void 0:void 0)||function(){return a.valueFull},d=(null!=e?null!=(f=e.set)?f.bind(this.object):void 0:void 0)||function(){},Object.defineProperty(this.object,this.property,{configurable:!0,enumerable:null!=e?e.enumerable:void 0,get:function(){return c()},set:function(b){a.setValue(b);return d(b)}}),b||(this.inheritedOverriden=!0)):this.needsManualUpdate=!0,this.setArrayMethods()},
setArrayMethods:function(){var a;if(l.mutateArrayMethods&&Array.isArray(this.valueFull))return this.arrayMethodsMutated=!0,a=this,["push","pop","shift","unshift","splice"].forEach(function(b){return Object.defineProperty(a.valueFull,b,{configurable:!0,value:function(){var c;c=Array.prototype[b].apply(a.valueFull,arguments);a.updateDeps();return c}})})},handleUpdateFromEvent:function(){var a;a="Event"===this.type?arguments[this.property]:this.fetchDirectValue();return this.setValue(a)},invokeEventMethod:function(a,
b,c){var d;d=this.object;if(this.isDOM&&v.jQuery&&"on"===b||"off"===b)d=jQuery(this.object);d[b]||(b=c);this.updateHandler||(this.updateHandler=this.handleUpdateFromEvent.bind(this));return"function"===typeof d[b]?d[b](a,this.updateHandler):void 0},networkReq:function(a,b){var c,d,e,g,f,h,k,m;k=this.object+":"+this.selector+"#"+this.reqOptions.method;f=G[k];h=null!=f?f.date:void 0;d=function(c){return function(){return c.updateDeps(a,b)}}(this);if(h&&h!==this.lastReq&&l.cacheRequests)this.value=f.data,
"*"!==this.property&&(this.value=this.valueFull=this.value[this.property]),d();else try{this.lastReq=Date.now();this.reqOptions.data&&(c=JSON.stringify(this.reqOptions.data));this.xhr=new XMLHttpRequest;this.xhr.open(this.reqOptions.method.toUpperCase(),this.object,!0);g=this.reqOptions.headers;for(e in g)m=g[e],this.xhr.setRequestHeader(e,m);this.xhr.onreadystatechange=function(a){return function(){var b;if(4===a.xhr.readyState){if(a.value=a.valueFull=b=a.xhr.responseText)try{a.value=JSON.parse(b),
"*"!==a.property&&(a.value=a.valueFull=a.value[a.property])}catch(c){}G[k]={date:a.lastReq,data:a.value};return d()}}}(this);this.xhr.send(c)}catch(O){}},addDep:function(a,b){-1===this.deps.indexOf(a)&&this.deps.push(a);b?-1===this.depsBothWays.indexOf(a)&&this.depsBothWays.push(a):-1!==a.deps.indexOf(this)&&(a.addDep(this,!0),this.addDep(a,!0));return this},removeDep:function(a,b){var c;c=this.deps.indexOf(a);-1!==c&&this.deps.splice(c,1);if(b&&(this.depsBothWays.forEach(function(a){return function(b){return b.removeDep(a)}}(this)),
c=this.depsBothWays.indexOf(a),-1!==c))return this.depsBothWays.splice(c,1)},removeAllDeps:function(a){var b,c,d,e;e=this.deps.slice();c=0;for(d=e.length;c<d;c++)b=e[c],this.removeDep(b,a);if(a)return this.destroy()},addTransform:function(a,b){return this.transforms[a]=b},registerEvent:function(a,b){if(-1===this.attachedEvents.indexOf(a))return this.attachedEvents.push(a),this.invokeEventMethod(a,b||"addEventListener","addEventListener")},unRegisterEvent:function(a,b){var c;c=this.attachedEvents.indexOf(a);
if(-1!==c)return this.attachedEvents.splice(c,1),this.invokeEventMethod(a,b||"removeEventListener","removeEventListener")},addPollInterval:function(a){return this.pollInterval=setInterval(function(a){return function(){var c;c=a.fetchDirectValue();if(c!==a.valueFull)return a.setValue(c)}}(this),a)},removePollInterval:function(){clearInterval(this.pollInterval);return this.pollInterval=null}};k.prototype={of:function(a){var b,c;0!==this.stage&&2!==this.stage&&f(g[0]);"object"!==typeof a&&"function"!==
typeof a&&w("badObject");0===this.stage?c=this._.setObject("object",a):(b=this.proxies.indexOf(this.proxied),this.proxied=this.proxied.of(a),this.proxies[b]=this.proxied,this.has.initBind=!0,this.has.tf=!1,this._.addDep(this.proxied._),t(this));return c instanceof k?c:this["new"](this.stage+1)},ofEvent:function(a,b){(0!==this.stage||this.has.event)&&f(g[1]);if(!a||"string"!==typeof a)return this;this._.setEvent(a,b);this.has.event=!0;return this["new"](0)},ofExternal:function(a,b,c){(0!==this.stage||
this.has.event)&&f(g[2]);if(b&&"object"!==typeof b||!a||"string"!==typeof a)return this;a=this._.setObject("external",a,c,c?"POST":"GET",b);return a instanceof k?a:this["new"](1)},to:function(a){(1!==this.stage||this.has.initBind)&&f(g[3]);if(null==a)return this;0===A(this,a).stage?a=2:(a=3,this.has.initBind=!0);return this["new"](a)},and:function(a){var b;3===this.stage&&this.has.initBind&&!this.has.massTf||f(g[4]);if(null==a)return this;b=A(this,a);0===b.stage?a=2:(a=3,this.has.tf=!1);return this["new"](a,
b,this.proxies.concat(b))},toExternal:function(a,b){1!==this.stage&&f(g[5]);if(b&&"object"!==typeof b||!a||"string"!==typeof a)return this;this.proxied=p("*").ofExternal(a,b,!0);this._.addDep(this.proxied._);this.has.initBind=!0;t(this);return this["new"](3,this.proxied)},set:function(a){0!==this.stage&&2!==this.stage||f(g[6]);this._.setValue(a);return this},get:function(){0!==this.stage&&2!==this.stage||f(g[7]);return this._.value},transform:function(a){(3!==this.stage||this.has.tf||this.has.massTf)&&
f(g[8]);this.has.tf=this._.processTransformCall(a,[this.proxied])||!1;return this["new"](3)},transformAll:function(a){(3!==this.stage||this.has.tf||this.has.massTf)&&f(g[9]);this.has.massTf=this._.processTransformCall(a,this.proxies)||!1;return this["new"](3)},bothWays:function(){var a,b;(3!==this.stage||this.has.massTf)&&f(g[10]);b=this._.transforms;a=this.proxied._;null!=b[this.proxied.ID]?a.addDep(this._,!0).addTransform(this.ID,b[a.ID]):a.addDep(this._,!0);this._.addDep(a,!0);return this},unBind:function(a){3!==
this.stage&&f(g[11]);this._.removeDep(this.proxied._,a);return this},chainTo:function(a){3!==this.stage&&f(g[12]);return p(this.proxied).to(a)},pollEvery:function(a){(3!==this.stage||"Event"===this._.type||this.has.interval)&&f(g[13]);this._.addPollInterval(a);this.has.interval=!0;return this["new"](3)},stopPolling:function(){3===this.stage&&this.has.interval||f(g[14]);this._.removePollInterval();return this["new"](3)},updateDepsOnEvent:function(a,b){3!==this.stage&&f(g[15]);this._.registerEvent(a,
b);return this},removeEvent:function(a,b){3!==this.stage&&f(g[16]);this._.unRegisterEvent(a,b);return this}};k.prototype.update=k.prototype.set;k.prototype.twoWay=k.prototype.bothWays;k.prototype.pipe=k.prototype.chainTo;g=Object.keys(k.prototype);A=function(a,b){var c;a.proxied=c=p(b,!0);0!==c.stage&&(a._.addDep(c._),t(a));return c};t=function(a){if("Func"!==a.proxied._.type||l.invokeOnBind)return a._.updateDeps(a.ID,!0)};Object.defineProperty(p,"options",{get:function(){return l}});p.setOption=
function(a,b){if(-1!==Object.keys(l).indexOf(a))return-1!==a.indexOf("place")&&(u[a.slice(11).toLowerCase()]=b.replace(/(.)/g,"\\$1")),l[a]=b};p.setOptions=function(a){var b;b=Object.keys(a);if(b.length)return b.forEach(function(b){return p.setOption(b,a[b])})};p.unBindAll=function(a,b){var c,d,e;if(a&&("object"===typeof a||"function"===typeof a)&&(a=J(a),c=h.objects.indexOf(a),-1!==c))for(e in d=h.props[c],d)c=d[e],q[c].removeAllDeps(b)};return window.SimplyBind=p})();
